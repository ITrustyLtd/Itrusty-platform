// ========================================
// EXTENDED BILINGUAL TRANSLATIONS
// I Trusty Ltd - English / 中文简体
// ========================================

const extendedTranslations = {
    en: {
        // Common
        yes: 'Yes',
        no: 'No',
        ok: 'OK',
        cancel: 'Cancel',
        save: 'Save',
        edit: 'Edit',
        delete: 'Delete',
        create: 'Create',
        update: 'Update',
        search: 'Search',
        filter: 'Filter',
        export: 'Export',
        import: 'Import',
        upload: 'Upload',
        download: 'Download',
        loading: 'Loading...',
        error: 'Error',
        success: 'Success',
        warning: 'Warning',
        info: 'Information',
        
        // Navigation
        dashboard: 'Dashboard',
        orders: 'Orders',
        customers: 'Customers',
        workflow: 'Workflow',
        staff: 'Staff',
        financials: 'Financials',
        office_financials: 'Office Financials',
        staff_costs: 'Staff Costs',
        settings: 'Settings',
        logout: 'Logout',
        back_to_dashboard: 'Back to Dashboard',
        
        // Orders
        order_number: 'Order Number',
        order_date: 'Order Date',
        order_status: 'Order Status',
        order_type: 'Order Type',
        order_direction: 'Order Direction',
        sub_order_number: 'Sub-Order Number',
        new_order: 'New Order',
        edit_order: 'Edit Order',
        delete_order: 'Delete Order',
        create_order: 'Create Order',
        customer_to_us: 'Customer → Us',
        us_to_supplier: 'Us → Supplier',
        
        // Customer
        customer: 'Customer',
        customer_name: 'Customer Name',
        customer_code: 'Customer Code',
        customer_info: 'Customer Information',
        customer_address: 'Customer Address',
        customer_contact: 'Customer Contact',
        customer_email: 'Customer Email',
        customer_phone: 'Customer Phone',
        select_customer: 'Select customer...',
        add_new_customer: 'Add New Customer',
        
        // Product
        product: 'Product',
        product_name: 'Product Name',
        product_code: 'Product Code',
        product_description: 'Product Description',
        product_sku: 'Product SKU',
        quantity: 'Quantity',
        unit_price: 'Unit Price',
        total_price: 'Total Price',
        add_product: 'Add Product',
        
        // Supplier
        supplier: 'Supplier',
        supplier_name: 'Supplier Name',
        supplier_code: 'Supplier Code',
        supplier_info: 'Supplier Information',
        supplier_cost: 'Supplier Cost',
        supplier_payment: 'Supplier Payment',
        
        // Financial
        price: 'Price',
        cost: 'Cost',
        revenue: 'Revenue',
        profit: 'Profit',
        profit_margin: 'Profit Margin',
        total_revenue: 'Total Revenue',
        total_cost: 'Total Cost',
        net_profit: 'Net Profit',
        purchase_price: 'Purchase Price',
        selling_price: 'Selling Price',
        currency: 'Currency',
        amount: 'Amount',
        payment: 'Payment',
        payment_date: 'Payment Date',
        payment_method: 'Payment Method',
        payment_status: 'Payment Status',
        customer_payments: 'Customer Payments',
        outstanding_balance: 'Outstanding Balance',
        total_paid: 'Total Paid',
        add_payment: 'Add Payment',
        
        // Workflow Steps
        step_request: 'Request',
        step_sourcing: 'Sourcing',
        step_quotation: 'Quotation Prep',
        step_approval: 'Customer Approval',
        step_proforma: 'Proforma Invoice',
        step_deposit: 'Deposit Payment',
        step_po: 'Purchase Order',
        step_production: 'Production',
        step_qc: 'QC Inspection',
        step_balance: 'Balance Payment',
        step_packing: 'Packing',
        step_customs: 'Customs Declaration',
        step_shipping: 'Shipping Booked',
        step_transit: 'In Transit',
        step_clearance: 'Customs Clearance',
        step_delivery: 'Delivery',
        step_completed: 'Completed',
        
        // Status
        status: 'Status',
        received: 'Received',
        processing: 'Processing',
        production: 'Production',
        quality_check: 'Quality Check',
        shipped: 'Shipped',
        delivered: 'Delivered',
        cancelled: 'Cancelled',
        not_started: 'Not Started',
        in_progress: 'In Progress',
        completed: 'Completed',
        blocked: 'Blocked',
        on_hold: 'On Hold',
        pending: 'Pending',
        paid: 'Paid',
        scheduled: 'Scheduled',
        
        // Priority
        priority: 'Priority',
        low: 'Low',
        medium: 'Medium',
        high: 'High',
        urgent: 'Urgent',
        
        // Office
        office: 'Office',
        assigned_office: 'Assigned Office',
        yiwu: 'Yiwu',
        shenzhen: 'Shenzhen',
        greece: 'Greece',
        both: 'Both',
        
        // Dates
        date: 'Date',
        created_date: 'Created Date',
        start_date: 'Start Date',
        due_date: 'Due Date',
        completion_date: 'Completion Date',
        delivery_date: 'Delivery Date',
        
        // Files
        files: 'Files',
        attachments: 'Attachments',
        upload_file: 'Upload File',
        order_documents: 'Order Documents',
        supported_formats: 'Supported: PDF, DOC, XLS, Images (Max 20MB per file)',
        
        // Multi-product
        order_items: 'Order Items',
        multi_product: 'Multi-Product',
        
        // Roles & Permissions
        role: 'Role',
        administrator: 'Administrator',
        manager: 'Manager',
        staff: 'Staff',
        permissions: 'Permissions',
        no_permission: 'You don\'t have permission to view this',
        restricted: 'Restricted',
        contact_administrator: 'Please contact your administrator',
        
        // Messages
        confirm_delete: 'Are you sure you want to delete?',
        confirm_delete_order: 'Delete order and all associated data?',
        type_to_confirm: 'Type to confirm',
        save_success: 'Saved successfully!',
        delete_success: 'Deleted successfully!',
        error_occurred: 'An error occurred',
        no_orders: 'No orders yet',
        no_customers: 'No customers yet',
        no_data: 'No data available',
        
        // Actions
        view_details: 'View Details',
        add_comment: 'Add Comment',
        add_note: 'Add Note',
        assign_to: 'Assign To',
        change_status: 'Change Status',
        upload_photo: 'Upload Photo',
        
        // Units
        units: 'units',
        hours: 'hours',
        days: 'days',
        
        // Language
        language: 'Language',
        english: 'English',
        chinese: 'Chinese'
    },
    
    'zh-CN': {
        // Common - 常用
        yes: '是',
        no: '否',
        ok: '确定',
        cancel: '取消',
        save: '保存',
        edit: '编辑',
        delete: '删除',
        create: '创建',
        update: '更新',
        search: '搜索',
        filter: '筛选',
        export: '导出',
        import: '导入',
        upload: '上传',
        download: '下载',
        loading: '加载中...',
        error: '错误',
        success: '成功',
        warning: '警告',
        info: '信息',
        
        // Navigation - 导航
        dashboard: '仪表板',
        orders: '订单',
        customers: '客户',
        workflow: '工作流程',
        staff: '员工',
        financials: '财务',
        office_financials: '办公室财务',
        staff_costs: '员工成本',
        settings: '设置',
        logout: '登出',
        back_to_dashboard: '返回仪表板',
        
        // Orders - 订单
        order_number: '订单号',
        order_date: '订单日期',
        order_status: '订单状态',
        order_type: '订单类型',
        order_direction: '订单方向',
        sub_order_number: '子订单号',
        new_order: '新建订单',
        edit_order: '编辑订单',
        delete_order: '删除订单',
        create_order: '创建订单',
        customer_to_us: '客户 → 我们',
        us_to_supplier: '我们 → 供应商',
        
        // Customer - 客户
        customer: '客户',
        customer_name: '客户名称',
        customer_code: '客户代码',
        customer_info: '客户信息',
        customer_address: '客户地址',
        customer_contact: '客户联系人',
        customer_email: '客户邮箱',
        customer_phone: '客户电话',
        select_customer: '选择客户...',
        add_new_customer: '添加新客户',
        
        // Product - 产品
        product: '产品',
        product_name: '产品名称',
        product_code: '产品代码',
        product_description: '产品描述',
        product_sku: '产品SKU',
        quantity: '数量',
        unit_price: '单价',
        total_price: '总价',
        add_product: '添加产品',
        
        // Supplier - 供应商
        supplier: '供应商',
        supplier_name: '供应商名称',
        supplier_code: '供应商代码',
        supplier_info: '供应商信息',
        supplier_cost: '供应商成本',
        supplier_payment: '供应商付款',
        
        // Financial - 财务
        price: '价格',
        cost: '成本',
        revenue: '收入',
        profit: '利润',
        profit_margin: '利润率',
        total_revenue: '总收入',
        total_cost: '总成本',
        net_profit: '净利润',
        purchase_price: '采购价',
        selling_price: '销售价',
        currency: '货币',
        amount: '金额',
        payment: '付款',
        payment_date: '付款日期',
        payment_method: '付款方式',
        payment_status: '付款状态',
        customer_payments: '客户付款',
        outstanding_balance: '未付余额',
        total_paid: '已付总额',
        add_payment: '添加付款',
        
        // Workflow Steps - 工作流程步骤
        step_request: '询价',
        step_sourcing: '采购',
        step_quotation: '报价准备',
        step_approval: '客户确认',
        step_proforma: '形式发票',
        step_deposit: '定金付款',
        step_po: '采购订单',
        step_production: '生产',
        step_qc: '质检',
        step_balance: '尾款付款',
        step_packing: '包装',
        step_customs: '报关',
        step_shipping: '订舱',
        step_transit: '运输中',
        step_clearance: '清关',
        step_delivery: '交付',
        step_completed: '完成',
        
        // Status - 状态
        status: '状态',
        received: '已接收',
        processing: '处理中',
        production: '生产中',
        quality_check: '质检',
        shipped: '已发货',
        delivered: '已交付',
        cancelled: '已取消',
        not_started: '未开始',
        in_progress: '进行中',
        completed: '已完成',
        blocked: '受阻',
        on_hold: '搁置',
        pending: '待处理',
        paid: '已付',
        scheduled: '已安排',
        
        // Priority - 优先级
        priority: '优先级',
        low: '低',
        medium: '中',
        high: '高',
        urgent: '紧急',
        
        // Office - 办公室
        office: '办公室',
        assigned_office: '分配办公室',
        yiwu: '义乌',
        shenzhen: '深圳',
        greece: '希腊',
        both: '两者',
        
        // Dates - 日期
        date: '日期',
        created_date: '创建日期',
        start_date: '开始日期',
        due_date: '截止日期',
        completion_date: '完成日期',
        delivery_date: '交付日期',
        
        // Files - 文件
        files: '文件',
        attachments: '附件',
        upload_file: '上传文件',
        order_documents: '订单文档',
        supported_formats: '支持格式：PDF、DOC、XLS、图片（单个文件最大20MB）',
        
        // Multi-product - 多产品
        order_items: '订单项目',
        multi_product: '多产品',
        
        // Roles & Permissions - 角色和权限
        role: '角色',
        administrator: '管理员',
        manager: '经理',
        staff: '员工',
        permissions: '权限',
        no_permission: '您没有权限查看此内容',
        restricted: '受限',
        contact_administrator: '请联系您的管理员',
        
        // Messages - 消息
        confirm_delete: '确定要删除吗？',
        confirm_delete_order: '删除订单及所有相关数据？',
        type_to_confirm: '输入以确认',
        save_success: '保存成功！',
        delete_success: '删除成功！',
        error_occurred: '发生错误',
        no_orders: '暂无订单',
        no_customers: '暂无客户',
        no_data: '暂无数据',
        
        // Actions - 操作
        view_details: '查看详情',
        add_comment: '添加评论',
        add_note: '添加备注',
        assign_to: '分配给',
        change_status: '更改状态',
        upload_photo: '上传照片',
        
        // Units - 单位
        units: '件',
        hours: '小时',
        days: '天',
        
        // Language - 语言
        language: '语言',
        english: '英语',
        chinese: '中文'
    }
};

// ========================================
// TRANSLATION FUNCTION
// ========================================

/**
 * Get translation for a key
 * @param {string} key - Translation key
 * @param {string} lang - Language code (en, zh-CN)
 * @returns {string} Translated text
 */
function t(key, lang = null) {
    const userLang = lang || getCurrentUserLanguage();
    return extendedTranslations[userLang]?.[key] || extendedTranslations['en']?.[key] || key;
}

/**
 * Get current user language from RBAC system or localStorage
 * @returns {string} Language code
 */
function getCurrentUserLanguage() {
    // Try RBAC system first
    if (window.RBAC && window.RBAC.getCurrentUser) {
        const user = window.RBAC.getCurrentUser();
        if (user?.language_preference) return user.language_preference;
    }
    
    // Fallback to localStorage
    return localStorage.getItem('language_preference') || 'en';
}

/**
 * Switch language and reload UI
 * @param {string} newLang - New language code (en, zh-CN)
 */
function switchLanguage(newLang) {
    // Update localStorage
    localStorage.setItem('language_preference', newLang);
    
    // Update user in database if logged in
    if (window.RBAC && window.RBAC.getCurrentUser) {
        const user = window.RBAC.getCurrentUser();
        if (user && user.id) {
            fetch(`tables/users/${user.id}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ language_preference: newLang })
            }).catch(err => console.warn('Failed to update language preference:', err));
            
            // Update current user object
            user.language_preference = newLang;
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
    }
    
    // Reload page to apply translations
    location.reload();
}

/**
 * Auto-translate all elements with data-translate attribute
 */
function translatePage() {
    const lang = getCurrentUserLanguage();
    
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const placeholder = element.getAttribute('data-translate-placeholder');
        
        // Translate text content
        if (key) {
            element.textContent = t(key, lang);
        }
        
        // Translate placeholder
        if (placeholder) {
            element.placeholder = t(placeholder, lang);
        }
    });
    
    // Update language switcher buttons
    updateLanguageSwitcher(lang);
}

/**
 * Update language switcher button states
 * @param {string} currentLang - Current language
 */
function updateLanguageSwitcher(currentLang) {
    const enBtn = document.getElementById('lang-en');
    const zhBtn = document.getElementById('lang-zh');
    
    if (enBtn && zhBtn) {
        if (currentLang === 'en') {
            enBtn.classList.add('bg-blue-100', 'text-blue-700', 'font-semibold');
            enBtn.classList.remove('hover:bg-gray-100');
            zhBtn.classList.remove('bg-blue-100', 'text-blue-700', 'font-semibold');
            zhBtn.classList.add('hover:bg-gray-100');
        } else {
            zhBtn.classList.add('bg-blue-100', 'text-blue-700', 'font-semibold');
            zhBtn.classList.remove('hover:bg-gray-100');
            enBtn.classList.remove('bg-blue-100', 'text-blue-700', 'font-semibold');
            enBtn.classList.add('hover:bg-gray-100');
        }
    }
}

// ========================================
// AUTO-INITIALIZE
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    translatePage();
    console.log('✅ I18n Extended loaded, language:', getCurrentUserLanguage());
});

// ========================================
// EXPORT FOR GLOBAL USE
// ========================================

window.i18n = {
    t,
    switchLanguage,
    translatePage,
    getCurrentUserLanguage,
    translations: extendedTranslations
};

console.log('✅ Extended Translations System loaded');
